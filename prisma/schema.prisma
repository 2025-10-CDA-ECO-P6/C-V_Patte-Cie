generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  userId       String        @id @default(uuid()) @map("user_id") @db.Uuid
  email        String        @unique @db.VarChar(100)
  passwordHash String        @map("password_hash") @db.VarChar(255)
  userRole     UserRole      @map("user_role")
  createdAt    DateTime?     @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt    DateTime?     @default(now()) @updatedAt @map("updated_at") @db.Timestamp(6)
  owner        Owner?
  veterinarian Veterinarian?

  @@map("user")
}

model Owner {
  ownerId   String    @id @default(uuid()) @map("owner_id") @db.Uuid
  userId    String    @unique @map("user_id") @db.Uuid
  name      String    @db.VarChar(100)
  phone     String    @db.VarChar(25)
  address   String    @db.VarChar(255)
  createdAt DateTime? @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt DateTime? @default(now()) @updatedAt @map("updated_at") @db.Timestamp(6)
  animals   Animal[]
  user      User      @relation(fields: [userId], references: [userId], onDelete: Cascade, map: "fk_owner_user")

  @@map("owner")
}

model Veterinarian {
  veterinarianId String       @id @default(uuid()) @map("veterinarian_id") @db.Uuid
  userId         String       @unique @map("user_id") @db.Uuid
  name           String       @db.VarChar(100)
  phone          String       @db.VarChar(25)
  createdAt      DateTime?    @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt      DateTime?    @default(now()) @updatedAt @map("updated_at") @db.Timestamp(6)
  vaccines       Vaccine[]
  user           User         @relation(fields: [userId], references: [userId], onDelete: Cascade, map: "fk_veterinarian_user")
  visits         Visit[]

  @@map("veterinarian")
}

model Animal {
  animalId    String    @id @default(uuid()) @map("animal_id") @db.Uuid
  name        String    @db.VarChar(100)
  species     String    @db.VarChar(50)
  breed       String    @db.VarChar(100)
  dateOfBirth DateTime  @map("date_of_birth") @db.Date
  picture     String?   @db.VarChar(255)
  weight      Decimal   @db.Decimal(6, 2)
  gender      String    @db.Char(1)
  ownerId     String    @map("owner_id") @db.Uuid
  createdAt   DateTime? @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt   DateTime? @default(now()) @updatedAt @map("updated_at") @db.Timestamp(6)
  owner       Owner     @relation(fields: [ownerId], references: [ownerId], onDelete: Cascade, map: "fk_animal_owner")
  vaccines    Vaccine[]
  visits      Visit[]

  @@index([ownerId], map: "idx_animal_owner")
  @@index([species], map: "idx_animal_species")
  @@index([name], map: "idx_animal_name")
  @@map("animal")
}

model Visit {
  visitId        String       @id @default(uuid()) @map("visit_id") @db.Uuid
  date           DateTime     @db.Timestamp(6)
  reason         String
  visitStatus    VisitStatus  @map("visit_status")
  observation    String?
  animalId       String       @map("animal_id") @db.Uuid
  veterinarianId String       @map("veterinarian_id") @db.Uuid
  createdAt      DateTime?    @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt      DateTime?    @default(now()) @updatedAt @map("updated_at") @db.Timestamp(6)
  animal         Animal       @relation(fields: [animalId], references: [animalId], onDelete: Cascade, map: "fk_visit_animal")
  veterinarian   Veterinarian @relation(fields: [veterinarianId], references: [veterinarianId], map: "fk_visit_veterinarian")

  @@index([animalId], map: "idx_visit_animal")
  @@index([veterinarianId], map: "idx_visit_veterinarian")
  @@index([date(sort: Desc)], map: "idx_visit_date")
  @@map("visit")
}

model Vaccine {
  vaccineId          String        @id @default(uuid()) @map("vaccine_id") @db.Uuid
  name               String        @db.VarChar(100)
  administrationDate DateTime?     @map("administration_date") @db.Date
  vaccineStatus      VaccineStatus @map("vaccine_status")
  reminderDelays     Int[]         @map("reminder_delays")
  veterinarianId     String?       @map("veterinarian_id") @db.Uuid
  animalId           String?       @map("animal_id") @db.Uuid
  createdAt          DateTime?     @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt          DateTime?     @default(now()) @updatedAt @map("updated_at") @db.Timestamp(6)
  animal             Animal?       @relation(fields: [animalId], references: [animalId], map: "fk_vaccine_animal")
  veterinarian       Veterinarian? @relation(fields: [veterinarianId], references: [veterinarianId], map: "fk_vaccine_veterinarian")

  @@index([animalId], map: "idx_vaccine_animal")
  @@index([veterinarianId], map: "idx_vaccine_veterinarian")
  @@map("vaccine")
}

enum UserRole {
  owner
  veterinarian
  admin
}

enum VisitStatus {
  scheduled
  completed
  cancelled
}

enum VaccineStatus {
  pending
  administered
  expired
}
